= Prometheus (prometheus)

`prometheus` 端点以 Prometheus 服务器抓取所需的格式提供 Spring Boot 应用程序的指标。

== 检索所有指标

要检索所有指标，可以通过 `GET` 请求访问 `/actuator/prometheus`，以下是基于 curl 的示例：

[source,bash]
----
curl 'http://localhost:8080/actuator/prometheus' -i -X GET
----

返回的响应类似于以下内容：

----
HTTP/1.1 200 OK
Content-Type: text/plain;version=0.0.4;charset=utf-8
Content-Length: 3097

# HELP jvm_buffer_count_buffers An estimate of the number of buffers in the pool
# TYPE jvm_buffer_count_buffers gauge
jvm_buffer_count_buffers{id="direct"} 16.0
jvm_buffer_count_buffers{id="mapped"} 0.0
jvm_buffer_count_buffers{id="mapped - 'non-volatile memory'"} 0.0
# HELP jvm_buffer_memory_used_bytes An estimate of the memory that the Java virtual machine is using for this buffer pool
# TYPE jvm_buffer_memory_used_bytes gauge
jvm_buffer_memory_used_bytes{id="direct"} 1.7043464E7
jvm_buffer_memory_used_bytes{id="mapped"} 0.0
jvm_buffer_memory_used_bytes{id="mapped - 'non-volatile memory'"} 0.0
# HELP jvm_buffer_total_capacity_bytes An estimate of the total capacity of the buffers in this pool
# TYPE jvm_buffer_total_capacity_bytes gauge
jvm_buffer_total_capacity_bytes{id="direct"} 1.7043463E7
jvm_buffer_total_capacity_bytes{id="mapped"} 0.0
jvm_buffer_total_capacity_bytes{id="mapped - 'non-volatile memory'"} 0.0
# HELP jvm_memory_committed_bytes The amount of memory in bytes that is committed for the Java virtual machine to use
# TYPE jvm_memory_committed_bytes gauge
jvm_memory_committed_bytes{area="heap",id="G1 Eden Space"} 3.7748736E7
jvm_memory_committed_bytes{area="heap",id="G1 Old Gen"} 1.22683392E8
jvm_memory_committed_bytes{area="heap",id="G1 Survivor Space"} 4194304.0
jvm_memory_committed_bytes{area="nonheap",id="CodeHeap 'non-nmethods'"} 2555904.0
jvm_memory_committed_bytes{area="nonheap",id="CodeHeap 'non-profiled nmethods'"} 4915200.0
jvm_memory_committed_bytes{area="nonheap",id="CodeHeap 'profiled nmethods'"} 2.0250624E7
jvm_memory_committed_bytes{area="nonheap",id="Compressed Class Space"} 1.2189696E7
jvm_memory_committed_bytes{area="nonheap",id="Metaspace"} 8.8735744E7
# HELP jvm_memory_max_bytes The maximum amount of memory in bytes that can be used for memory management
# TYPE jvm_memory_max_bytes gauge
jvm_memory_max_bytes{area="heap",id="G1 Eden Space"} -1.0
jvm_memory_max_bytes{area="heap",id="G1 Old Gen"} 1.073741824E9
jvm_memory_max_bytes{area="heap",id="G1 Survivor Space"} -1.0
jvm_memory_max_bytes{area="nonheap",id="CodeHeap 'non-nmethods'"} 5836800.0
jvm_memory_max_bytes{area="nonheap",id="CodeHeap 'non-profiled nmethods'"} 1.22912768E8
jvm_memory_max_bytes{area="nonheap",id="CodeHeap 'profiled nmethods'"} 1.22908672E8
jvm_memory_max_bytes{area="nonheap",id="Compressed Class Space"} 1.073741824E9
jvm_memory_max_bytes{area="nonheap",id="Metaspace"} -1.0
# HELP jvm_memory_used_bytes The amount of used memory
# TYPE jvm_memory_used_bytes gauge
jvm_memory_used_bytes{area="heap",id="G1 Eden Space"} 2.2020096E7
jvm_memory_used_bytes{area="heap",id="G1 Old Gen"} 8.380416E7
jvm_memory_used_bytes{area="heap",id="G1 Survivor Space"} 3202304.0
jvm_memory_used_bytes{area="nonheap",id="CodeHeap 'non-nmethods'"} 1442048.0
jvm_memory_used_bytes{area="nonheap",id="CodeHeap 'non-profiled nmethods'"} 4866688.0
jvm_memory_used_bytes{area="nonheap",id="CodeHeap 'profiled nmethods'"} 2.0246272E7
jvm_memory_used_bytes{area="nonheap",id="Compressed Class Space"} 1.176576E7
jvm_memory_used_bytes{area="nonheap",id="Metaspace"} 8.7867568E7
----

默认的响应内容类型是 `text/plain;version=0.0.4`。当使用适当的 `Accept` 头进行调用时，端点还可以生成 `application/openmetrics-text;version=1.0.0`，以下是基于 curl 的示例：

[source,bash]
----
curl 'http://localhost:8080/actuator/prometheus' -i -X GET \
-H 'Accept: application/openmetrics-text; version=1.0.0; charset=utf-8'
----

返回的响应类似于以下内容：

----
HTTP/1.1 200 OK
Content-Type: application/openmetrics-text;version=1.0.0;charset=utf-8
Content-Length: 3102

# TYPE jvm_buffer_count_buffers gauge
# HELP jvm_buffer_count_buffers An estimate of the number of buffers in the pool
jvm_buffer_count_buffers{id="direct"} 16.0
jvm_buffer_count_buffers{id="mapped"} 0.0
jvm_buffer_count_buffers{id="mapped - 'non-volatile memory'"} 0.0
# TYPE jvm_buffer_memory_used_bytes gauge
# HELP jvm_buffer_memory_used_bytes An estimate of the memory that the Java virtual machine is using for this buffer pool
jvm_buffer_memory_used_bytes{id="direct"} 1.7043464E7
jvm_buffer_memory_used_bytes{id="mapped"} 0.0
jvm_buffer_memory_used_bytes{id="mapped - 'non-volatile memory'"} 0.0
# TYPE jvm_buffer_total_capacity_bytes gauge
# HELP jvm_buffer_total_capacity_bytes An estimate of the total capacity of the buffers in this pool
jvm_buffer_total_capacity_bytes{id="direct"} 1.7043463E7
jvm_buffer_total_capacity_bytes{id="mapped"} 0.0
jvm_buffer_total_capacity_bytes{id="mapped - 'non-volatile memory'"} 0.0
# TYPE jvm_memory_committed_bytes gauge
# HELP jvm_memory_committed_bytes The amount of memory in bytes that is committed for the Java virtual machine to use
jvm_memory_committed_bytes{area="heap",id="G1 Eden Space"} 3.7748736E7
jvm_memory_committed_bytes{area="heap",id="G1 Old Gen"} 1.22683392E8
jvm_memory_committed_bytes{area="heap",id="G1 Survivor Space"} 4194304.0
jvm_memory_committed_bytes{area="nonheap",id="CodeHeap 'non-nmethods'"} 2555904.0
jvm_memory_committed_bytes{area="nonheap",id="CodeHeap 'non-profiled nmethods'"} 4915200.0
jvm_memory_committed_bytes{area="nonheap",id="CodeHeap 'profiled nmethods'"} 2.0250624E7
jvm_memory_committed_bytes{area="nonheap",id="Compressed Class Space"} 1.2189696E7
jvm_memory_committed_bytes{area="nonheap",id="Metaspace"} 8.8670208E7
# TYPE jvm_memory_max_bytes gauge
# HELP jvm_memory_max_bytes The maximum amount of memory in bytes that can be used for memory management
jvm_memory_max_bytes{area="heap",id="G1 Eden Space"} -1.0
jvm_memory_max_bytes{area="heap",id="G1 Old Gen"} 1.073741824E9
jvm_memory_max_bytes{area="heap",id="G1 Survivor Space"} -1.0
jvm_memory_max_bytes{area="nonheap",id="CodeHeap 'non-nmethods'"} 5836800.0
jvm_memory_max_bytes{area="nonheap",id="CodeHeap 'non-profiled nmethods'"} 1.22912768E8
jvm_memory_max_bytes{area="nonheap",id="CodeHeap 'profiled nmethods'"} 1.22908672E8
jvm_memory_max_bytes{area="nonheap",id="Compressed Class Space"} 1.073741824E9
jvm_memory_max_bytes{area="nonheap",id="Metaspace"} -1.0
# TYPE jvm_memory_used_bytes gauge
# HELP jvm_memory_used_bytes The amount of used memory
jvm_memory_used_bytes{area="heap",id="G1 Eden Space"} 2.097152E7
jvm_memory_used_bytes{area="heap",id="G1 Old Gen"} 8.380416E7
jvm_memory_used_bytes{area="heap",id="G1 Survivor Space"} 3202304.0
jvm_memory_used_bytes{area="nonheap",id="CodeHeap 'non-nmethods'"} 1442048.0
jvm_memory_used_bytes{area="nonheap",id="CodeHeap 'non-profiled nmethods'"} 4862208.0
jvm_memory_used_bytes{area="nonheap",id="CodeHeap 'profiled nmethods'"} 2.0206336E7
jvm_memory_used_bytes{area="nonheap",id="Compressed Class Space"} 1.176184E7
jvm_memory_used_bytes{area="nonheap",id="Metaspace"} 8.7831424E7
# EOF
----

=== 查询参数

端点使用查询参数来限制返回的样本。下表显示了支持的查询参数：

[%autowidth]
|===
|参数|描述
|`includedNames`|将样本限制为与名称匹配的样本。可选。
|===

== 检索过滤的指标

要检索与特定名称匹配的指标，可以通过 `GET` 请求访问 `/actuator/prometheus`，并使用 includedNames 查询参数，以下是基于 curl 的示例：

[source,bash]
----
curl 'http://localhost:8080/actuator/prometheus?includedNames=jvm_memory_used_bytes%2Cjvm_memory_committed_bytes' -i -X GET
----

返回的响应类似于以下内容：

----
HTTP/1.1 200 OK
Content-Type: text/plain;version=0.0.4;charset=utf-8
Content-Length: 1459

# HELP jvm_memory_committed_bytes The amount of memory in bytes that is committed for the Java virtual machine to use
# TYPE jvm_memory_committed_bytes gauge
jvm_memory_committed_bytes{area="heap",id="G1 Eden Space"} 3.7748736E7
jvm_memory_committed_bytes{area="heap",id="G1 Old Gen"} 1.22683392E8
jvm_memory_committed_bytes{area="heap",id="G1 Survivor Space"} 4194304.0
jvm_memory_committed_bytes{area="nonheap",id="CodeHeap 'non-nmethods'"} 2555904.0
jvm_memory_committed_bytes{area="nonheap",id="CodeHeap 'non-profiled nmethods'"} 4915200.0
jvm_memory_committed_bytes{area="nonheap",id="CodeHeap 'profiled nmethods'"} 2.031616E7
jvm_memory_committed_bytes{area="nonheap",id="Compressed Class Space"} 1.2189696E7
jvm_memory_committed_bytes{area="nonheap",id="Metaspace"} 8.8735744E7
# HELP jvm_memory_used_bytes The amount of used memory
# TYPE jvm_memory_used_bytes gauge
jvm_memory_used_bytes{area="heap",id="G1 Eden Space"} 2.3068672E7
jvm_memory_used_bytes{area="heap",id="G1 Old Gen"} 8.380416E7
jvm_memory_used_bytes{area="heap",id="G1 Survivor Space"} 3202304.0
jvm_memory_used_bytes{area="nonheap",id="CodeHeap 'non-nmethods'"} 1442048.0
jvm_memory_used_bytes{area="nonheap",id="CodeHeap 'non-profiled nmethods'"} 4878592.0
jvm_memory_used_bytes{area="nonheap",id="CodeHeap 'profiled nmethods'"} 2.027264E7
jvm_memory_used_bytes{area="nonheap",id="Compressed Class Space"} 1.176636E7
jvm_memory_used_bytes{area="nonheap",id="Metaspace"} 8.7872888E7
----
